<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<script>
    function payNow(){

        let name = document.getElementById("racerName").value.trim();
        let phone = document.getElementById("phoneNumber").value.trim();
        let village = document.getElementById("village").value.trim();
        let terms = document.getElementById("agreeTerms").checked;

        if(!name || !phone || !village){
            alert("Fill all fields");
            return;
        }

        if(phone.length !== 10){
            alert("Phone must be 10 digits");
            return;
        }

        if(!terms){
            alert("Accept terms");
            return;
        }

        fetch("/create-order", { method:"POST" })
        .then(res => res.json())
        .then(order => {

            var options = {

                // ðŸ”´ VERY IMPORTANT: PUT YOUR LIVE KEY HERE
                key: "rzp_live_SK6h49R5C0Hihf",

                amount: order.amount,
                currency: "INR",
                name: "Bull Run Pro",
                description: "Registration Fee",
                order_id: order.id,

                handler: function(response){

                    let form = document.getElementById("registrationForm");

                    let p1 = document.createElement("input");
                    p1.type = "hidden";
                    p1.name = "paymentId";
                    p1.value = response.razorpay_payment_id;
                    form.appendChild(p1);

                    let p2 = document.createElement("input");
                    p2.type = "hidden";
                    p2.name = "orderId";
                    p2.value = response.razorpay_order_id;
                    form.appendChild(p2);

                    let p3 = document.createElement("input");
                    p3.type = "hidden";
                    p3.name = "signature";
                    p3.value = response.razorpay_signature;
                    form.appendChild(p3);

                    form.submit();
                },

                // âœ… Added prefill (important for live mode)
                prefill: {
                    name: name,
                    contact: phone
                },

                theme: {
                    color: "#ff6600"
                }
            };

            var rzp = new Razorpay(options);
            rzp.open();

        })
        .catch(error => {
            console.error("Order creation failed:", error);
            alert("Unable to initiate payment. Try again.");
        });
    }
</script>