<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Event Registration</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>

        body{
        margin:0;
        font-family:Arial;
        background:url('/images/background.jpg') center/cover fixed;
        }

        .container{
        display:flex;
        justify-content:center;
        align-items:center;
        min-height:100vh;
        padding:20px;
        }

        .form-box{
        background:white;
        padding:30px;
        width:400px;
        border-radius:15px;
        box-shadow:0 10px 25px rgba(0,0,0,0.3);
        text-align:center;
        }

        input{
        width:100%;
        padding:10px;
        margin:8px 0;
        border-radius:8px;
        border:1px solid #ccc;
        }

        .pay-btn{
        width:100%;
        padding:10px;
        background:#ff6600;
        color:white;
        border:none;
        border-radius:8px;
        cursor:pointer;
        font-size:16px;
        }

        .pay-btn:hover{
        background:#e65c00;
        }

        .link{
        display:block;
        margin-top:15px;
        font-weight:bold;
        color:#333;
        text-decoration:none;
        }

        .terms{
        font-size:13px;
        text-align:left;
        margin-top:10px;
        }

        .language-box{
        position:absolute;
        right:20px;
        top:18px;
        }

    </style>

</head>

<body>

<div class="language-box">
    <button onclick="switchLanguage('en')">English</button>
    <button onclick="switchLanguage('mr')">मराठी</button>
</div>

<div class="container">

    <div class="form-box">

        <h2 id="formTitle">Event Registration</h2>

        <form id="registrationForm"
              th:action="@{/saveRacer}"
              th:object="${racer}"
              method="post">

            <input type="text"
                   th:field="*{racerName}"
                   id="racerName"
                   placeholder="Participant Name"
                   required>

            <input type="tel"
                   th:field="*{phoneNumber}"
                   id="phoneNumber"
                   placeholder="Phone Number"
                   maxlength="10"
                   required>

            <input type="text"
                   th:field="*{village}"
                   id="village"
                   placeholder="Village"
                   required>

            <div class="terms">
                <label>
                    <input type="checkbox" id="agreeTerms" required>

                    <span id="termsText">
I agree that this payment is for event registration and management services only.
</span>

                </label>
            </div>

            <button type="button" class="pay-btn" onclick="payNow()">
                Pay ₹15 & Register
            </button>

        </form>

        <a href="/racers" class="link" id="viewLink">
            View Registered Participants
        </a>

    </div>
</div>

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<script>

    function payNow(){

    let name=document.getElementById("racerName").value.trim();
    let phone=document.getElementById("phoneNumber").value.trim();
    let village=document.getElementById("village").value.trim();

    if(name==="" || phone==="" || village===""){
    alert("Please fill all fields");
    return;
    }

    if(phone.length!==10){
    alert("Phone number must be 10 digits");
    return;
    }

    if(!document.getElementById("agreeTerms").checked){
    alert("Accept terms first");
    return;
    }

    fetch("/create-order",{
    method:"POST"
    })
    .then(res=>res.json())
    .then(order=>{

    var options={
    key:"YOUR_RAZORPAY_KEY_ID",
    amount:order.amount,
    currency:"INR",
    name:"Bull Run Pro",
    description:"Registration Fee",
    order_id:order.id,

    handler:function(){

    document.getElementById("registrationForm").submit();

    },

    theme:{
    color:"#ff6600"
    }
    };

    var rzp=new Razorpay(options);
    rzp.open();

    });

    }

</script>

<script>

    document.getElementById("phoneNumber")
    .addEventListener("input",function(){
    this.value=this.value.replace(/[^0-9]/g,'');
    });

</script>

<script>

    function switchLanguage(lang){

    if(lang==='mr'){

    document.getElementById("formTitle").innerText="कार्यक्रम नोंदणी";

    document.getElementById("racerName").placeholder="स्पर्धकाचे नाव";
    document.getElementById("phoneNumber").placeholder="फोन नंबर";
    document.getElementById("village").placeholder="गाव";

    document.querySelector(".pay-btn").innerText="₹15 भरा व नोंदणी करा";

    document.getElementById("viewLink").innerText="नोंदणीकृत स्पर्धक पहा";

    document.getElementById("termsText").innerText=
    "मी सहमत आहे की ही रक्कम फक्त कार्यक्रम नोंदणीसाठी आहे.";

    }else{

    document.getElementById("formTitle").innerText="Event Registration";

    document.getElementById("racerName").placeholder="Participant Name";
    document.getElementById("phoneNumber").placeholder="Phone Number";
    document.getElementById("village").placeholder="Village";

    document.querySelector(".pay-btn").innerText="Pay ₹15 & Register";

    document.getElementById("viewLink").innerText="View Registered Participants";

    document.getElementById("termsText").innerText=
    "I agree that this payment is for event registration only.";

    }

    }

</script>

</body>
</html>