<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Sports Event Registration | BullRunPro</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        *{
            margin:0;
            padding:0;
            box-sizing:border-box;
            font-family:'Segoe UI',sans-serif;
        }

        body{
            min-height:100vh;
            display:flex;
            justify-content:center;
            align-items:center;
            background:
                linear-gradient(rgba(0,0,0,0.6),rgba(0,0,0,0.6)),
                url('/images/background.jpg') no-repeat center center fixed;
            background-size:cover;
            transition:0.4s ease;
        }

        body.dark{
            background:
                linear-gradient(rgba(0,0,0,0.8),rgba(0,0,0,0.8)),
                url('/images/background.jpg') no-repeat center center fixed;
            background-size:cover;
        }

        .top-bar{
            position:absolute;
            top:20px;
            right:20px;
            display:flex;
            gap:8px;
        }

        .toggle-btn{
            background:white;
            border:none;
            padding:6px 10px;
            border-radius:6px;
            font-size:12px;
            font-weight:bold;
            cursor:pointer;
            transition:0.3s;
        }

        .toggle-btn:hover{
            background:#ff6600;
            color:white;
        }

        .form-box{
            width:400px;
            padding:40px;
            border-radius:20px;
            backdrop-filter:blur(20px);
            background:rgba(255,255,255,0.15);
            border:1px solid rgba(255,255,255,0.2);
            box-shadow:0 25px 60px rgba(0,0,0,0.6);
            color:white;
            animation:fadeIn 0.6s ease;
        }

        @keyframes fadeIn{
            from{opacity:0;transform:translateY(20px);}
            to{opacity:1;transform:translateY(0);}
        }

        h2{
            text-align:center;
            margin-bottom:25px;
        }

        input{
            width:100%;
            padding:12px;
            margin-bottom:15px;
            border-radius:8px;
            border:none;
            font-size:14px;
        }

        input:focus{
            outline:none;
            box-shadow:0 0 8px rgba(255,102,0,0.8);
        }

        label{
            font-size:13px;
            display:flex;
            gap:6px;
            margin-bottom:15px;
        }

        .pay-btn{
            width:100%;
            padding:12px;
            border:none;
            border-radius:8px;
            background:linear-gradient(45deg,#ff6600,#ff8533);
            color:white;
            font-weight:bold;
            cursor:pointer;
            transition:0.3s;
        }

        .pay-btn:hover{
            background:black;
            color:#ff6600;
        }

        .home-btn{
            display:block;
            margin-top:15px;
            padding:10px;
            border-radius:8px;
            text-decoration:none;
            font-weight:bold;
            background:black;
            color:white;
            text-align:center;
            transition:0.3s;
        }

        .home-btn:hover{
            background:#ff6600;
        }

        @media(max-width:450px){
            .form-box{
                width:90%;
                padding:30px;
            }
        }
    </style>
</head>

<body>

<div class="top-bar">
    <button class="toggle-btn" onclick="toggleMode()">üåô</button>
    <button class="toggle-btn" onclick="switchLang('en')">EN</button>
    <button class="toggle-btn" onclick="switchLang('mr')">‡§Æ‡§∞‡§æ‡§†‡•Ä</button>
</div>

<div class="form-box">

    <h2 id="titleText">Event Registration</h2>

    <form id="registrationForm"
          th:action="@{/saveRacer}"
          th:object="${racer}"
          method="post">

        <input type="text" th:field="*{racerName}" id="racerName" placeholder="Participant Name" required>

        <input type="tel" th:field="*{phoneNumber}" id="phoneNumber" placeholder="Phone Number" required>

        <input type="text" th:field="*{village}" id="village" placeholder="Village" required>

        <label>
            <input type="checkbox" id="agreeTerms" required>
            <span id="termsText">I agree that this payment is for registration only.</span>
        </label>

        <button type="button" class="pay-btn" id="payText" onclick="payNow()">
            Pay ‚Çπ15 & Register
        </button>

        <a th:href="@{/}" class="home-btn" id="homeText">üè† Back to Home</a>

    </form>
</div>

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<script>

    /* DARK MODE SAVE */
    if(localStorage.getItem("darkMode")==="enabled"){
        document.body.classList.add("dark");
    }

    function toggleMode(){
        document.body.classList.toggle("dark");
        if(document.body.classList.contains("dark")){
            localStorage.setItem("darkMode","enabled");
        }else{
            localStorage.setItem("darkMode","disabled");
        }
    }

    /* LANGUAGE SAVE */
    function switchLang(lang){
        localStorage.setItem("language",lang);

        if(lang==='mr'){
            document.getElementById("titleText").innerText="‡§∏‡•ç‡§™‡§∞‡•ç‡§ß‡§æ ‡§®‡•ã‡§Ç‡§¶‡§£‡•Ä";
            document.getElementById("termsText").innerText="‡§π‡•Ä ‡§∞‡§ï‡•ç‡§ï‡§Æ ‡§´‡§ï‡•ç‡§§ ‡§®‡•ã‡§Ç‡§¶‡§£‡•Ä‡§∏‡§æ‡§†‡•Ä ‡§Ü‡§π‡•á.";
            document.getElementById("payText").innerText="‚Çπ15 ‡§≠‡§∞‡§æ ‡§Ü‡§£‡§ø ‡§®‡•ã‡§Ç‡§¶‡§£‡•Ä ‡§ï‡§∞‡§æ";
            document.getElementById("homeText").innerText="üè† ‡§Æ‡•Å‡§ñ‡•ç‡§Ø‡§™‡•É‡§∑‡•ç‡§†";

            document.getElementById("racerName").placeholder="‡§∏‡•ç‡§™‡§∞‡•ç‡§ß‡§ï ‡§®‡§æ‡§µ";
            document.getElementById("phoneNumber").placeholder="‡§Æ‡•ã‡§¨‡§æ‡§à‡§≤ ‡§®‡§Ç‡§¨‡§∞";
            document.getElementById("village").placeholder="‡§ó‡§æ‡§µ";
        }else{
            location.reload();
        }
    }

    if(localStorage.getItem("language")==="mr"){
        switchLang("mr");
    }

    /* PAYMENT */
    function payNow(){

        let name = document.getElementById("racerName").value.trim();
        let phone = document.getElementById("phoneNumber").value.trim();
        let village = document.getElementById("village").value.trim();
        let terms = document.getElementById("agreeTerms").checked;

        if(!name || !phone || !village){
            alert("Fill all fields");
            return;
        }

        if(phone.length !== 10){
            alert("Phone must be 10 digits");
            return;
        }

        if(!terms){
            alert("Accept terms");
            return;
        }

        fetch("/create-order",{method:"POST"})
        .then(res=>res.json())
        .then(order=>{

            var options={
                key:"rzp_test_SKWE8OHx1FB2OJ",
                amount:order.amount,
                currency:"INR",
                name:"Bull Run Pro",
                description:"Registration Fee",
                order_id:order.id,

                handler:function(response){
                    let form=document.getElementById("registrationForm");

                    ["razorpay_payment_id","razorpay_order_id","razorpay_signature"]
                    .forEach(field=>{
                        let input=document.createElement("input");
                        input.type="hidden";
                        input.name=field;
                        input.value=response[field];
                        form.appendChild(input);
                    });

                    form.submit();
                },

                prefill:{
                    name:name,
                    contact:phone
                },

                theme:{color:"#ff6600"}
            };

            var rzp=new Razorpay(options);
            rzp.open();
        })
        .catch(()=>{
            alert("Unable to initiate payment. Try again.");
        });
    }
</script>

</body>
</html>