<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Admin - Manage Groups</title>

    <style>
        body {
            font-family: Arial;
            background: #f4f6f9;
            padding: 30px;
        }

        h2 {
            text-align: center;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0px 4px 12px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        input[type="number"] {
            padding: 6px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }

        button {
            padding: 8px 14px;
            border-radius: 5px;
            border: none;
            cursor: pointer;
            font-weight: bold;
        }

        .generate-btn { background: #3498db; color: white; }
        .publish-btn { background: green; color: white; }
        .unpublish-btn { background: red; color: white; }
        .delete-btn { background: #e67e22; color: white; }
        .print-btn { background: #2c3e50; color: white; }

        .group-container {
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0px 3px 10px rgba(0,0,0,0.1);
        }

        .group-container:nth-child(odd) { background: #ffffff; }
        .group-container:nth-child(even) { background: #fdf2e9; }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        th {
            background: #2c3e50;
            color: white;
            padding: 10px;
        }

        td {
            padding: 8px;
            text-align: center;
            border-bottom: 1px solid #ddd;
        }

        tr:nth-child(even) { background: #f8f9fa; }

        .actions {
            margin-top: 15px;
        }
    </style>

    <script>
        function confirmGenerate() {
            return confirm("Are you sure? Old groups will be replaced.");
        }

        function confirmDelete() {
            return confirm("Delete all groups?");
        }

        function printGroup(id) {
            var content = document.getElementById(id).innerHTML;
            var win = window.open('', '', 'height=600,width=800');
            win.document.write(content);
            win.print();
            win.close();
        }
    </script>

</head>
<body>

<h2>üèÅ Admin - Manage Race Groups</h2>

<div class="card">

    <!-- Generate Groups -->
    <form th:action="@{/admin/generate-groups}" method="post"
          onsubmit="return confirmGenerate();">
        <label><strong>Group Size:</strong></label>
        <input type="number" name="groupSize" min="2" required>
        <button type="submit" class="generate-btn">Generate Groups</button>
    </form>

    <br>

    <!-- Publish / Unpublish -->
    <div th:if="${!published}">
        <form th:action="@{/admin/publish-groups}" method="post">
            <button type="submit" class="publish-btn">
                Publish Groups
            </button>
        </form>
    </div>

    <div th:if="${published}">
        <form th:action="@{/admin/unpublish-groups}" method="post">
            <button type="submit" class="unpublish-btn">
                Unpublish Groups
            </button>
        </form>
    </div>

    <br>

    <!-- Delete Groups -->
    <form th:action="@{/admin/delete-groups}" method="post"
          onsubmit="return confirmDelete();">
        <button type="submit" class="delete-btn">
            Delete All Groups
        </button>
    </form>

</div>

<hr>

<h3>Generated Groups</h3>

<div th:each="entry : ${groupedRacers}"
     th:id="'group-' + ${entry.key}"
     class="group-container">

    <h3>
        Group <span th:text="${entry.key}"></span>
        ( <span th:text="${#lists.size(entry.value)}"></span> Racers )
    </h3>

    <table>
        <thead>
        <tr>
            <th>Registration Number</th>
            <th>Name</th>
            <th>Village</th>
        </tr>
        </thead>

        <tbody>
        <tr th:each="r : ${entry.value}">
            <td th:text="${r.registrationNumber}"></td>
            <td th:text="${r.racerName}"></td>
            <td th:text="${r.village}"></td>
        </tr>
        </tbody>
    </table>

    <div class="actions">
        <button class="print-btn"
                th:onclick="'printGroup(\'group-' + ${entry.key} + '\')'">
            Print Group
        </button>
    </div>

</div>

</body>
</html>